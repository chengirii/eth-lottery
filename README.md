# 基于以太坊区块哈希的公平抽奖工具

这是一个利用以太坊的公开数据来确保抽奖过程完全公平、透明和可验证的工具。任何人都可以独立验证抽奖结果是否真实可信。

##  核心特性

- **可验证性**: 抽奖结果的计算过程是确定性的，任何人都可以使用相同的代码和数据重复计算，以验证中奖者的真实性。
- **公平透明**: 抽奖的关键种子来源于未来的、不可预测的以太坊区块哈希。在开奖时间确定之前，没有人能预测或操控结果。
- **可配置**: 您可以通过 `config.json` 文件轻松配置抽奖活动，无需修改代码。
- **易于使用**: 通过简单的命令行指令即可完成抽奖和验证。

---

## 种子计算逻辑

为了确保公平性，抽奖算法的核心——“种子(seed)”——是基于一组公开且在开奖前不可预测的数据生成的。

初始种子由以下四个关键数据拼接而成：

1.  **抽奖活动ID (`lottery_id`)**: 在 `config.json` 中定义的本次抽奖的唯一标识符。
2.  **参与者总数 (`len(participants)`)**: 参与抽奖的总人数。
3.  **奖品数量 (`prizes`)**: 本次抽奖的奖品总数。
4.  **区块哈希 (`block_hash`)**: 这是最关键的随机性来源。程序会获取您指定的**开奖时间点之后产生的第一个以太坊区块的哈希值**。由于在那个时间点到来之前，没有人能准确预测这个哈希值，因此保证了结果的随机和公正。

**计算过程如下：**

1.  程序将以上四个数据按顺序拼接成一个字符串。
    ```
    seed_string = f"{lottery_id}{len(participants)}{prizes}{block_hash}"
    ```
2.  然后，程序使用 **SHA-256** 算法计算这个字符串的哈希值，生成**初始种子 (`initial_seed`)**。
    ```python
    initial_seed = hashlib.sha256(seed_str.encode()).hexdigest()
    ```
3.  在抽取第一个中奖者后，如果还有剩余奖品，程序会**将当前的种子再次进行 SHA-256 哈希**，生成下一个种子，用于抽取下一位中奖者。这个过程会一直重复，直到所有奖品抽取完毕。

这个设计确保了整个抽奖过程是**一个确定性的链条**，只要初始数据（尤其是区块哈希）确定了，中奖结果就是唯一确定的。

---

## 如何使用（运行抽奖）

#### 第一步：配置

打开 `config.json` 文件，根据您的需求修改以下字段：

- `lottery_id`: 为您的抽奖活动设置一个独特的名称。
- `participants`: 一个列表，包含所有参与者的唯一ID或名称。
- `prizes`: 奖品的数量。

```json
{
  "lottery_id": "MyAwesomeLottery",
  "participants": [
    "Alice",
    "Bob",
    "Charlie",
    "David",
    "Eve"
  ],
  "prizes": 1
}
```

#### 第二步：执行抽奖

打开您的命令行工具，进入项目所在的目录，然后运行以下命令之一：

- **立即开奖**（使用当前系统时间）：
  ```bash
  python eth_lottery.py draw
  ```

- **在指定时间开奖**（程序会等待到该时间点）：
  ```bash
  python eth_lottery.py draw --time 1753352667
  ```
  > 请将时间替换为您需要的未来时间。
  

#### 第三步：获取并分发结果

抽奖完成后，程序会在当前目录下生成一个 `result.json` 文件。此文件包含了中奖名单和所有用于验证的数据。您可以将这个文件分享给所有参与者。

---

## 如何验证

任何人只要拥有 `eth_lottery.py`, `config.json`, 和 `result.json` 这三个文件，就可以轻松验证结果的公正性。

#### 第一步：准备文件

确保 `eth_lottery.py` 和 `result.json` 这两个文件都在同一个文件夹内。

#### 第二步：执行验证

```bash
python eth_lottery.py verify
```

#### 第三步：查看结果

- 如果命令行输出 **`验证成功！`**，这证明 `result.json` 中的中奖名单是完全正确的，是通过程序公正计算得出的。
- 如果命令行输出 **`验证失败！`**，则说明 `result.json` 中的结果与程序计算出的不一致，结果可能被篡改过或存在错误。

---

## V2EX 回复提取工具 (`v2ex_reply.py`)

这是一个用于从 V2EX API 获取指定主题的回复并提取用户名的工具。

### 如何使用

打开您的命令行工具，进入项目所在的目录，然后运行以下命令：

```bash
python v2ex_reply.py --topic_id <您的主题ID> --auth_token <您的Bearer Token> [--content_keyword <关键词>] [--created_before <时间戳>]
```

**参数说明：**

*   `--topic_id`: **必需**，V2EX 主题的 ID。
*   `--auth_token`: **必需**，您的 V2EX API 的 Bearer Token。
*   `--content_keyword`: **可选**，回复内容中包含的关键词。
*   `--created_before`: **可选**，回复创建时间戳，只获取在此时间戳之前的回复。

**示例：**

```bash
python v2ex_reply.py --topic_id 1147426 --auth_token "YOUR_ACTUAL_TOKEN" --content_keyword "MAKE IT" --created_before 1678886400
```

*   提取到的用户名将保存到 `usernames.json` 文件中。